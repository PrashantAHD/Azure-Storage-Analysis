# Azure Storage Analysis

[![Python](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![Azure](https://img.shields.io/badge/azure-storage-0078d4.svg)](https://azure.microsoft.com/en-us/services/storage/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

> **Professional Azure Storage cost analysis and optimization tool with multi-subscription support**

## üéØ Overview

This project provides comprehensive analysis of Azure Storage usage and costs. It connects directly to your Azure subscriptions, analyzes storage resources, and generates detailed reports with actionable cost optimization recommendations.

## üìä Analysis Scope
- **Data Sources:**
  - Raw Azure storage usage and billing CSV exports
   - Enhanced Excel reports generated by the analysis tool
- **Metrics Analyzed:**
  - Storage account usage (by type, region, and SKU)
  - Cost breakdowns (monthly, by resource, by storage class)
  - Growth trends and historical usage
  - Unused or underutilized storage resources
  - Recommendations for cost savings and optimization

## üí° Recommendations Provided
- Identify unused or infrequently accessed storage accounts and blobs
- Suggest moving data to lower-cost storage tiers (e.g., Cool, Archive)
- Highlight opportunities for lifecycle management and automation
- Recommend deletion or consolidation of redundant resources
- Provide insights on data redundancy and geo-replication settings

## üìÅ Project Structure
```
Azure-Storage-Analysis/
‚îú‚îÄ‚îÄ cli.py                          # Main CLI entry point
‚îú‚îÄ‚îÄ requirements.txt                # Python dependencies
‚îú‚îÄ‚îÄ README.md                       # Project documentation
‚îú‚îÄ‚îÄ .gitignore                      # Git exclusion rules
‚îú‚îÄ‚îÄ azure_storage_analysis/         # Core analysis package
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                 # Package initialization
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                     # Azure authentication
‚îÇ   ‚îú‚îÄ‚îÄ core.py                     # Main analysis engine
‚îÇ   ‚îú‚îÄ‚îÄ recommendations.py          # Cost optimization
‚îÇ   ‚îú‚îÄ‚îÄ reporting.py                # Excel report generation
‚îÇ   ‚îî‚îÄ‚îÄ utils.py                    # Utility functions
‚îî‚îÄ‚îÄ tests/                          # Test framework
```

### Key Components
- `azure_storage_analysis/`: Core package with modular analysis logic (all main logic is here)
   - `core.py`, `auth.py`, `reporting.py`, `recommendations.py`, `utils.py`
- `cli.py`: Main entry point to run the analysis (imports from the package above)
- `azure_storage_analysis_*.csv`: Raw Azure storage data exports
- `azure_storage_analysis_enhanced_*.xlsx`: Enhanced analysis reports
- `requirements.txt`: Python dependencies

## üöÄ Quick Start

### Prerequisites
- Python 3.8 or higher
- Required Python packages (see below)
- Azure CLI (for authentication and subscription management)

### üîß Installation

#### 1. Azure CLI Setup
1. Download and install the Azure CLI from the official site:
   https://docs.microsoft.com/en-us/cli/azure/install-azure-cli
2. After installation, open a new terminal and run:
   ```powershell
   az login
   ```
   This will open a browser window for you to authenticate with your Azure account.
3. (Optional) Set your default subscription:
   ```powershell
   az account set --subscription "<your-subscription-name-or-id>"
   ```
4. Verify your login and subscription:
   ```powershell
   az account show
   ```

#### 2. Project Setup
1. Clone this repository:
   ```powershell
   git clone git@github.com:PrashantAHD/Azure-Storage-Analysis.git
   cd Azure-Storage-Analysis
   ```
2. (Optional) Create and activate a virtual environment:
   ```powershell
   python -m venv venv
   .\venv\Scripts\activate
   ```
3. Install required packages:
   ```powershell
   pip install -r requirements.txt
   ```

### üíª Usage

Run the analysis tool:
```powershell
python cli.py --auto
```

For additional options and help:
```powershell
python cli.py --help
```

## üìã Detailed Command Reference

### Core Commands
| Command | Description | Usage Example |
|---------|-------------|---------------|
| `--auto` | Automatic mode with intelligent prompts | `python cli.py --auto` |
| `--help` | Display comprehensive help information | `python cli.py --help` |

### Subscription Management
| Command | Description | Usage Example |
|---------|-------------|---------------|
| `--all-subscriptions` | Analyze all accessible subscriptions | `python cli.py --all-subscriptions --auto` |
| `--single-subscription` | Force analysis of current subscription only | `python cli.py --single-subscription --auto` |
| `--subscription-ids` | Analyze specific subscription IDs | `python cli.py --subscription-ids sub1 sub2 --auto` |

### Storage Filtering Options
| Command | Description | Usage Example |
|---------|-------------|---------------|
| `--account-names` | Filter by specific storage account names | `python cli.py --auto --account-names storage1 storage2` |
| `--account-pattern` | Filter using wildcard patterns | `python cli.py --auto --account-pattern "prod-*"` |
| `--no-containers` | Skip Blob Storage analysis | `python cli.py --auto --no-containers` |
| `--no-file-shares` | Skip Azure Files analysis | `python cli.py --auto --no-file-shares` |

### Performance & Export Options
| Command | Description | Usage Example |
|---------|-------------|---------------|
| `--max-workers` | Set concurrent worker threads (default: 10) | `python cli.py --auto --max-workers 20` |
| `--export-detailed-blobs` | Export detailed blob information | `python cli.py --auto --export-detailed-blobs` |
| `--export-detailed-files` | Export detailed file share information | `python cli.py --auto --export-detailed-files` |
| `--max-blobs-per-container` | Limit blob exports per container | `python cli.py --auto --export-detailed-blobs --max-blobs-per-container 1000` |

### Example Workflows
```powershell
# Enterprise production analysis
python cli.py --auto --account-pattern "prod-*" --export-detailed-blobs --max-workers 15

# Multi-subscription cost audit
python cli.py --all-subscriptions --auto --export-detailed-blobs --export-detailed-files

# Quick development environment check
python cli.py --single-subscription --auto --account-pattern "dev-*"

# High-performance analysis with filtering
python cli.py --auto --max-workers 25 --no-file-shares --max-blobs-per-container 500
```

### Output
- Enhanced Excel report: `azure_storage_analysis_enhanced_<date>.xlsx`
- Multi-sheet Excel report with:
  - **Executive Summary**: High-level metrics and KPIs
  - **Blob Storage Analysis**: Container-level details and insights
  - **Azure Files Analysis**: File share utilization and metrics
  - **Cost Optimization**: Detailed recommendations and savings calculations
  - **Raw Data**: Complete dataset for custom analysis

## Analysis Features

### Multi-Subscription Support
- Automatic detection of accessible Azure subscriptions
- Interactive subscription selection interface
- Batch processing across multiple subscriptions
- Consolidated reporting across subscription boundaries

### Cost Optimization Analysis
- Storage tier optimization recommendations (Hot/Cool/Archive)
- Lifecycle management policy suggestions
- Redundancy assessment (LRS/ZRS/GRS/RA-GRS)
- Unused resource identification (empty containers and shares)

### Performance & Scalability
- Configurable multi-threading for large-scale analysis
- Memory-efficient processing for large datasets
- Progress tracking with real-time updates

## Troubleshooting Guide

### Common Issues and Solutions

#### Authentication Problems
**Issue**: `Authentication failed` or `Unable to obtain credentials`
```bash
# Solution 1: Re-authenticate with Azure CLI
az logout
az login

# Solution 2: Check current account
az account show

# Solution 3: Set default subscription
az account set --subscription "your-subscription-id"
```

#### Permission Errors
**Issue**: `Access denied` or `Insufficient permissions`
- **Required Permissions**: `Storage Account Contributor` or `Reader` role
- **Subscription Access**: Ensure account has access to target subscriptions
- **Resource Group Permissions**: Verify read access to storage resource groups

#### Memory Issues
**Issue**: Out of memory errors with large datasets
```bash
# Solution 1: Process single subscription
python cli.py --single-subscription --auto

# Solution 2: Filter by specific accounts
python cli.py --auto --account-names "account1" "account2"

# Solution 3: Reduce concurrent operations
python cli.py --auto --max-workers 3
```

#### Excel Export Problems
**Issue**: Unable to generate Excel reports
```bash
# Install/update required packages
pip install --upgrade openpyxl pandas

# Check disk space
# Ensure sufficient disk space for report generation

# Alternative: Export to CSV only
python cli.py --auto --export-format csv
```

### Debug Mode
Enable detailed logging for troubleshooting:
```bash
# Set debug environment variable
set AZURE_STORAGE_DEBUG=1
python cli.py --auto

# Or use verbose output
python cli.py --auto --verbose
```

## Customization
- Modify or extend modules in `azure_storage_analysis/` to adjust analysis logic, reporting, or add new features.
- Update the CLI (`cli.py`) to support additional options or workflows.

## Support
For questions or suggestions, please open an issue on the GitHub repository.

## Azure Storage Cost Optimization Resources

### Key Strategies & Best Practices
- **Storage Tiering & Lifecycle Management:**
  - Move infrequently accessed data to Cool, Cold, or Archive tiers.
  - Use lifecycle policies to automate tier transitions and deletions.
  - Be aware of early deletion fees for each tier.
- **Reserved Capacity & Discounts:**
  - Commit to 1- or 3-year reserved capacity for predictable workloads to save up to 38% (storage) or 72% (compute).
  - Use Azure Cost Management to simulate and plan reservations.
- **Monitor, Audit, and Clean Up:**
  - Use Azure Advisor and Cost Management for recommendations and alerts.
  - Delete unused resources (disks, snapshots, storage accounts).
  - Right-size provisioned resources regularly.
- **Optimize Data Transfer and Redundancy:**
  - Minimize data egress by co-locating compute and storage.
  - Choose redundancy (LRS, ZRS, GRS, RA-GRS) based on cost and durability needs.
- **Backup and Encryption:**
  - Use incremental backups, set appropriate retention, and move long-term backups to Archive.
  - Use server-side encryption with managed keys for most scenarios.
- **Cost Management Tools:**
  - Use the [Azure Pricing Calculator](https://azure.microsoft.com/en-us/pricing/calculator/) to estimate costs.
  - Consider third-party tools like Ternary, Turbo360, IBM Cloudability for advanced cost visibility.
- **Case Studies:**
  - Companies like Maersk, ASOS, and H&R Block achieved savings by regular audits, training, and using Azure‚Äôs built-in cost management features.

### Useful Links
- [Azure Storage Pricing](https://azure.microsoft.com/en-us/pricing/details/storage/)
- [Azure Blob Storage Pricing](https://azure.microsoft.com/en-us/pricing/details/storage/blobs/)
- [Azure Managed Disks Pricing](https://azure.microsoft.com/en-us/pricing/details/managed-disks/)
- [Azure Advisor Cost Recommendations](https://learn.microsoft.com/en-us/azure/advisor/advisor-reference-cost-recommendations)
- [Azure Storage Access Tiers Overview](https://learn.microsoft.com/en-us/azure/storage/blobs/access-tiers-overview)
- [Azure Blob Lifecycle Management](https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-policy-access-tiers)
- [Azure Cost Management and Billing](https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/overview-cost-management)
- [Azure Pricing Calculator](https://azure.microsoft.com/en-us/pricing/calculator/)
- [CloudZero: Azure Storage Cost Optimization](https://www.cloudzero.com/blog/azure-storage-cost-optimization/)
- [Intercept: Azure Storage Pricing Guide](https://intercept.cloud/en-gb/blogs/azure-storage-pricing)
- [TechTarget: Azure Storage Pricing Guide](https://www.techtarget.com/searchstorage/tip/A-guide-to-Microsoft-Azure-storage-pricing)
- [N2WS: Azure Storage Cost Factors](https://n2ws.com/blog/microsoft-azure-cloud-services/azure-storage-costs)
- [Ternary: Azure Cost Management Tools](https://ternary.app/blog/azure-cost-management-tools/)
- [Medium: Azure Cost Optimization Stories](https://medium.com/@NickHystax/get-inspired-cost-optimization-stories-of-ms-azure-customers-ddf7ebf97042)

### Storage Types and Starting Prices (Sample)
| Storage Type         | Description                                      | Starting Price (per GiB/month) |
|---------------------|--------------------------------------------------|-------------------------------|
| Azure Blob          | Scalable object storage for unstructured data    | $0.015                        |
| Azure Files         | Managed file shares for cloud or on-prem use     | $0.0228                       |
| Azure Table         | NoSQL storage for structured data                | $0.045                        |
| Azure Queues        | Messaging for asynchronous app communication     | $0.045                        |
| Azure Managed Disks | Durable block storage for VMs                    | $0.30                         |

For more details, see the official [Azure Storage Pricing](https://azure.microsoft.com/en-us/pricing/details/storage/) page.
