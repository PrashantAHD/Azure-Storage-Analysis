# Azure Storage Analysis

## Overview
This project provides a comprehensive analysis of Azure Storage usage and costs. It processes Azure storage data, generates enhanced reports, and offers actionable recommendations to optimize storage usage and reduce costs.

## Analysis Scope
- **Data Sources:**
  - Raw Azure storage usage and billing CSV exports
   - Enhanced Excel reports generated by the analysis tool
- **Metrics Analyzed:**
  - Storage account usage (by type, region, and SKU)
  - Cost breakdowns (monthly, by resource, by storage class)
  - Growth trends and historical usage
  - Unused or underutilized storage resources
  - Recommendations for cost savings and optimization

## Recommendations Provided
- Identify unused or infrequently accessed storage accounts and blobs
- Suggest moving data to lower-cost storage tiers (e.g., Cool, Archive)
- Highlight opportunities for lifecycle management and automation
- Recommend deletion or consolidation of redundant resources
- Provide insights on data redundancy and geo-replication settings

## Project Structure
```
Azure-Storage-Analysis/
├── cli.py                          # Main CLI entry point
├── requirements.txt                # Python dependencies
├── README.md                       # Project documentation
├── .gitignore                      # Git exclusion rules
├── azure_storage_analysis/         # Core analysis package
│   ├── __init__.py                 # Package initialization
│   ├── auth.py                     # Azure authentication
│   ├── core.py                     # Main analysis engine
│   ├── recommendations.py          # Cost optimization
│   ├── reporting.py                # Excel report generation
│   └── utils.py                    # Utility functions
└── tests/                          # Test framework
```

### Key Components
- `azure_storage_analysis/`: Core package with modular analysis logic (all main logic is here)
   - `core.py`, `auth.py`, `reporting.py`, `recommendations.py`, `utils.py`
- `cli.py`: Main entry point to run the analysis (imports from the package above)
- `azure_storage_analysis_*.csv`: Raw Azure storage data exports
- `azure_storage_analysis_enhanced_*.xlsx`: Enhanced analysis reports
- `requirements.txt`: Python dependencies

## How to Run the Analysis


### Prerequisites
- Python 3.8 or higher
- Required Python packages (see below)
- Azure CLI (for authentication and subscription management)
- Azure storage usage CSV export (download from Azure Portal)

#### Azure CLI Setup
1. Download and install the Azure CLI from the official site:
   https://docs.microsoft.com/en-us/cli/azure/install-azure-cli
2. After installation, open a new terminal and run:
   ```powershell
   az login
   ```
   This will open a browser window for you to authenticate with your Azure account.
3. (Optional) Set your default subscription:
   ```powershell
   az account set --subscription "<your-subscription-name-or-id>"
   ```
4. Verify your login and subscription:
   ```powershell
   az account show
   ```

### Installation
1. Clone this repository:
   ```powershell
   git clone git@github.com:PrashantAHD/Azure-Storage-Analysis.git
   cd Azure-Storage-Analysis
   ```
2. (Optional) Create and activate a virtual environment:
   ```powershell
   python -m venv venv
   .\venv\Scripts\activate
   ```
3. Install required packages:
   ```powershell
   pip install -r requirements.txt
   ```
   If `requirements.txt` is not present, install common dependencies:
   ```powershell
   pip install pandas openpyxl
   ```

### Usage

#### Basic Analysis
```powershell
# Simple analysis of current subscription
python cli.py --auto

# Interactive subscription selection (if multiple available)
python cli.py --auto
# Will automatically detect and prompt for subscription selection

# Force single subscription mode
python cli.py --single-subscription --auto

# Analyze all accessible subscriptions
python cli.py --all-subscriptions --auto

# Analyze specific subscriptions
python cli.py --subscription-ids sub1 sub2 --auto
```

#### Advanced Options
```powershell
# Production environment analysis
python cli.py --auto --account-pattern "prod-*" --export-detailed-blobs

# Skip Azure Files analysis (Blob Storage only)
python cli.py --auto --no-file-shares

# Skip Blob Storage analysis (Azure Files only)
python cli.py --auto --no-containers

# High-performance analysis with more workers
python cli.py --auto --max-workers 20

# Filter by specific storage accounts
python cli.py --auto --account-names storage1 storage2

# Detailed analysis with export limits
python cli.py --auto --export-detailed-blobs --max-blobs-per-container 1000
```

#### Multi-Subscription Smart Selection
When you run `python cli.py --auto` and multiple subscriptions are available, you'll see:

```
🔍 Found 3 accessible subscriptions:
   1. Production Subscription (sub-prod-123)
   2. Development Subscription (sub-dev-456)
   3. Test Subscription (sub-test-789)

┌─────────────────────────────────────────────────────────────┐
│                 SUBSCRIPTION SELECTION                      │
└─────────────────────────────────────────────────────────────┘

Please choose your analysis scope:
  → Enter 'all' to analyze ALL subscriptions
  → Enter '1' to analyze the first subscription only
  → Enter '1,3' to analyze specific subscriptions (comma-separated)
  → Enter 'current' to analyze the current subscription only

📝 Your selection: 1,2
✅ Analysis Scope: 2 subscription(s) selected
   • Production Subscription
   • Development Subscription
```

#### Command Reference
| Command | Description | Example |
|---------|-------------|---------|
| `--auto` | Automatic mode with smart prompts | `python cli.py --auto` |
| `--all-subscriptions` | Analyze all accessible subscriptions | `python cli.py --all-subscriptions --auto` |
| `--single-subscription` | Force current subscription only | `python cli.py --single-subscription --auto` |
| `--subscription-ids` | Analyze specific subscription IDs | `python cli.py --subscription-ids sub1 sub2 --auto` |
| `--no-containers` | Skip Blob Storage analysis | `python cli.py --auto --no-containers` |
| `--no-file-shares` | Skip Azure Files analysis | `python cli.py --auto --no-file-shares` |
| `--max-workers` | Set concurrent worker threads | `python cli.py --auto --max-workers 15` |
| `--export-detailed-blobs` | Export detailed blob information | `python cli.py --auto --export-detailed-blobs` |
| `--export-detailed-files` | Export detailed file information | `python cli.py --auto --export-detailed-files` |
| `--account-names` | Specific storage account names | `python cli.py --auto --account-names acc1 acc2` |
| `--account-pattern` | Pattern to match account names | `python cli.py --auto --account-pattern "prod-*"` |

### Output
- Enhanced Excel report: `azure_storage_analysis_enhanced_<date>.xlsx`
- Multi-sheet Excel report with:
  - **Executive Summary**: High-level metrics and KPIs
  - **Blob Storage Analysis**: Container-level details and insights
  - **Azure Files Analysis**: File share utilization and metrics
  - **Cost Optimization**: Detailed recommendations and savings calculations
  - **Raw Data**: Complete dataset for custom analysis

## Backend Architecture

### Core Components

#### 1. **Authentication Layer** (`auth.py`)
- Azure CLI integration for authentication
- Multi-subscription credential management
- Service principal and managed identity support

#### 2. **Analysis Engine** (`core.py`)
- Concurrent processing with configurable worker threads
- Multi-subscription analysis orchestration
- Resource discovery and data collection
- Professional CLI interface with smart subscription selection

#### 3. **Cost Optimization Engine** (`recommendations.py`)
- Pattern recognition for usage analysis
- AI-powered cost optimization recommendations
- Savings calculation algorithms
- Priority-based recommendation ranking

#### 4. **Reporting Engine** (`reporting.py`)
- Multi-sheet Excel generation with professional formatting
- Chart generation and visual data representation
- Executive summary dashboards
- Detailed data export capabilities

#### 5. **Utilities Layer** (`utils.py`)
- Data formatting and human-readable conversions
- Input validation and error handling
- Pattern matching for advanced filtering
- Helper functions for common operations

### Key Features

#### Multi-Subscription Support
- **Intelligent Detection**: Automatically detects available subscriptions
- **Smart Selection**: Interactive selection interface for multiple subscriptions
- **Flexible Options**: Analyze all, specific, or current subscription only
- **Professional UI**: Clean, boxed interface with clear instructions

#### Cost Optimization
- **Lifecycle Management**: Identifies data suitable for tier transitions
- **Storage Tier Analysis**: Hot vs Cool vs Archive optimization
- **Redundancy Assessment**: LRS vs GRS right-sizing recommendations
- **Empty Resource Detection**: Unused containers and shares identification

#### Performance & Scalability
- **Concurrent Processing**: Configurable worker thread pools
- **Memory Optimization**: Efficient handling of large datasets
- **Error Recovery**: Robust exception handling and retry logic
- **Progress Tracking**: Real-time analysis progress indicators

## Customization
- Modify or extend modules in `azure_storage_analysis/` to adjust analysis logic, reporting, or add new features.
- Update the CLI (`cli.py`) to support additional options or workflows.

## Support
For questions or suggestions, please open an issue on the GitHub repository.

## Azure Storage Cost Optimization Resources

### Key Strategies & Best Practices
- **Storage Tiering & Lifecycle Management:**
  - Move infrequently accessed data to Cool, Cold, or Archive tiers.
  - Use lifecycle policies to automate tier transitions and deletions.
  - Be aware of early deletion fees for each tier.
- **Reserved Capacity & Discounts:**
  - Commit to 1- or 3-year reserved capacity for predictable workloads to save up to 38% (storage) or 72% (compute).
  - Use Azure Cost Management to simulate and plan reservations.
- **Monitor, Audit, and Clean Up:**
  - Use Azure Advisor and Cost Management for recommendations and alerts.
  - Delete unused resources (disks, snapshots, storage accounts).
  - Right-size provisioned resources regularly.
- **Optimize Data Transfer and Redundancy:**
  - Minimize data egress by co-locating compute and storage.
  - Choose redundancy (LRS, ZRS, GRS, RA-GRS) based on cost and durability needs.
- **Backup and Encryption:**
  - Use incremental backups, set appropriate retention, and move long-term backups to Archive.
  - Use server-side encryption with managed keys for most scenarios.
- **Cost Management Tools:**
  - Use the [Azure Pricing Calculator](https://azure.microsoft.com/en-us/pricing/calculator/) to estimate costs.
  - Consider third-party tools like Ternary, Turbo360, IBM Cloudability for advanced cost visibility.
- **Case Studies:**
  - Companies like Maersk, ASOS, and H&R Block achieved savings by regular audits, training, and using Azure’s built-in cost management features.

### Useful Links
- [Azure Storage Pricing](https://azure.microsoft.com/en-us/pricing/details/storage/)
- [Azure Blob Storage Pricing](https://azure.microsoft.com/en-us/pricing/details/storage/blobs/)
- [Azure Managed Disks Pricing](https://azure.microsoft.com/en-us/pricing/details/managed-disks/)
- [Azure Advisor Cost Recommendations](https://learn.microsoft.com/en-us/azure/advisor/advisor-reference-cost-recommendations)
- [Azure Storage Access Tiers Overview](https://learn.microsoft.com/en-us/azure/storage/blobs/access-tiers-overview)
- [Azure Blob Lifecycle Management](https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-policy-access-tiers)
- [Azure Cost Management and Billing](https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/overview-cost-management)
- [Azure Pricing Calculator](https://azure.microsoft.com/en-us/pricing/calculator/)
- [CloudZero: Azure Storage Cost Optimization](https://www.cloudzero.com/blog/azure-storage-cost-optimization/)
- [Intercept: Azure Storage Pricing Guide](https://intercept.cloud/en-gb/blogs/azure-storage-pricing)
- [TechTarget: Azure Storage Pricing Guide](https://www.techtarget.com/searchstorage/tip/A-guide-to-Microsoft-Azure-storage-pricing)
- [N2WS: Azure Storage Cost Factors](https://n2ws.com/blog/microsoft-azure-cloud-services/azure-storage-costs)
- [Ternary: Azure Cost Management Tools](https://ternary.app/blog/azure-cost-management-tools/)
- [Medium: Azure Cost Optimization Stories](https://medium.com/@NickHystax/get-inspired-cost-optimization-stories-of-ms-azure-customers-ddf7ebf97042)

### Storage Types and Starting Prices (Sample)
| Storage Type         | Description                                      | Starting Price (per GiB/month) |
|---------------------|--------------------------------------------------|-------------------------------|
| Azure Blob          | Scalable object storage for unstructured data    | $0.015                        |
| Azure Files         | Managed file shares for cloud or on-prem use     | $0.0228                       |
| Azure Table         | NoSQL storage for structured data                | $0.045                        |
| Azure Queues        | Messaging for asynchronous app communication     | $0.045                        |
| Azure Managed Disks | Durable block storage for VMs                    | $0.30                         |

For more details, see the official [Azure Storage Pricing](https://azure.microsoft.com/en-us/pricing/details/storage/) page.
